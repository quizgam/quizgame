
  <!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stick Fight Online</title>
<style>
  body { margin:0; background:#eee; font-family:sans-serif; text-align:center; }
  canvas { background:#cce; display:block; margin:0 auto; width:100%; height:60vh; }
  #hud { display:flex; justify-content:space-around; margin:4px; }
  .bar { width:40%; background:#333; height:20px; position:relative; }
  .life { background:#e22; height:100%; width:100%; }
  .controls { display:flex; flex-wrap:wrap; justify-content:center; margin-top:10px; }
  .btn { width:70px; height:70px; margin:5px; font-size:18px; }
</style>
</head>
<body>
<h2>Stick Fight Online</h2>
<div id="hud">
  <div class="bar"><div id="life1" class="life"></div></div>
  <div class="bar"><div id="life2" class="life"></div></div>
</div>
<canvas id="game"></canvas>
<div class="controls">
  <button class="btn" id="left">◀</button>
  <button class="btn" id="right">▶</button>
  <button class="btn" id="jump">⭡</button>
  <button class="btn" id="light">J</button>
  <button class="btn" id="heavy">K</button>
  <button class="btn" id="block">L</button>
</div>
<div>
  <button id="playAI">Jouer contre IA</button>
  <button id="playOnline">Jouer en ligne</button>
  <div id="status"></div>
</div>
<script>
const SIGNALING_SERVER_URL = 'wss://EXEMPLE_SIGNALING_SERVER'; // <== à remplacer
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth; canvas.height = window.innerHeight*0.6;

// Sons (base64 simples)
const sndHit = new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEA..."); // placeholder court
const sndStep = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEA...");

class Fighter {
  constructor(x,color){this.x=x;this.y=canvas.height-100;this.vx=0;this.vy=0;this.color=color;this.hp=15;this.dir=1;this.cool=0;}
  draw(){
    ctx.strokeStyle=this.color;ctx.lineWidth=5;
    ctx.beginPath();
    ctx.moveTo(this.x,this.y-40);ctx.lineTo(this.x,this.y);ctx.lineTo(this.x-20*this.dir,this.y+40);
    ctx.moveTo(this.x,this.y);ctx.lineTo(this.x+20*this.dir,this.y+40);
    ctx.moveTo(this.x,this.y-40);ctx.lineTo(this.x-20*this.dir,this.y-80);
    ctx.moveTo(this.x,this.y-40);ctx.lineTo(this.x+20*this.dir,this.y-80);
    ctx.stroke();
  }
  update(){this.x+=this.vx;this.y+=this.vy;if(this.cool>0)this.cool--;}
}
let p1=new Fighter(200,'black'), p2=new Fighter(canvas.width-200,'blue');
let ai=false, online=false, dataChannel=null;
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#070";ctx.fillRect(0,canvas.height-10,canvas.width,10);
  p1.update();p2.update();p1.draw();p2.draw();
}
function loop(){draw();requestAnimationFrame(loop);} loop();

// Input
let keys={};
document.addEventListener('keydown',e=>{keys[e.key]=true;});
document.addEventListener('keyup',e=>{keys[e.key]=false;});
function applyControls(f,k){if(k['a']||k['ArrowLeft'])f.vx=-3; else if(k['d']||k['ArrowRight'])f.vx=3; else f.vx=0;
  if((k['w']||k[' '])&&f.y>=canvas.height-100)f.vy=-10;
  f.vy+=0.5;if(f.y>canvas.height-100){f.y=canvas.height-100;f.vy=0;}
  if(k['j']&&f.cool==0){attack(f,1);}if(k['k']&&f.cool==0){attack(f,3);}
}
function attack(f,damage){f.cool=30; let target=(f==p1?p2:p1);
  if(Math.abs(f.x-target.x)<60){ target.hp-=damage; sndHit.play();
    for(let i=0;i<5;i++){particles.push({x:target.x,y:target.y-40,vx:(Math.random()-0.5)*5,vy:-Math.random()*5,life:30});}
    if(target.hp<=0){alert((f==p1?'J1':'J2')+" gagne!"); reset();}
  }
}
let particles=[];
function drawParticles(){
  ctx.fillStyle="red";
  particles.forEach(p=>{ctx.fillRect(p.x,p.y,3,3);p.x+=p.vx;p.y+=p.vy;p.vy+=0.2;p.life--;});
  particles=particles.filter(p=>p.life>0);
}
function gameLoop(){
  applyControls(p1,keys);
  if(ai&&!online) aiControls();
  p1.update();p2.update();
  document.getElementById('life1').style.width=(p1.hp/15*100)+"%";
  document.getElementById('life2').style.width=(p2.hp/15*100)+"%";
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#99d";ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#070";ctx.fillRect(0,canvas.height-10,canvas.width,10);
  p1.draw();p2.draw();drawParticles();
  requestAnimationFrame(gameLoop);
}
function reset(){p1.hp=p2.hp=15;}
function aiControls(){ if(p2.x>p1.x+60)p2.vx=-2; else if(p2.x<p1.x-60)p2.vx=2; else {p2.vx=0; if(Math.random()<0.05)attack(p2,2);} }
gameLoop();

// Boutons tactiles
function bindBtn(id,key){document.getElementById(id).addEventListener('mousedown',()=>keys[key]=true);
document.getElementById(id).addEventListener('mouseup',()=>keys[key]=false);
document.getElementById(id).addEventListener('touchstart',()=>keys[key]=true);
document.getElementById(id).addEventListener('touchend',()=>keys[key]=false);}
bindBtn('left','a');bindBtn('right','d');bindBtn('jump','w');bindBtn('light','j');bindBtn('heavy','k');bindBtn('block','l');

// Online setup (simplifié)
async function setupOnline(){
  const pc=new RTCPeerConnection(); dataChannel=pc.createDataChannel("game");
  dataChannel.onmessage=e=>{let d=JSON.parse(e.data);p2.x=d.x;p2.y=d.y;p2.hp=d.hp;};
  pc.onicecandidate=e=>{ if(e.candidate) sendSignal({candidate:e.candidate});};
  // Placeholder signaling
  document.getElementById('status').innerText="Connecté au signaling (placeholder)";
  online=true;ai=false;
}
function sendSignal(msg){/* TODO: WebSocket vers SIGNALING_SERVER_URL */}
// Buttons
document.getElementById('playAI').onclick=()=>{ai=true;online=false;};
document.getElementById('playOnline').onclick=()=>{setupOnline();};
</script>
</body>
</html>