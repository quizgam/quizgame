<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Jeu de Voiture R√©aliste</title>
  <style>
    body { margin: 0; overflow: hidden; background: #87CEEB; }
    canvas { display: block; margin: auto; background: #87CEEB; }
    #score {
      position: absolute;
      top: 10px; left: 10px;
      color: white; font-size: 20px;
      font-family: Arial, sans-serif;
    }
  </style>
</head>
<body>
<div id="score">Score: 0</div>
<canvas id="game" width="400" height="600"></canvas>

<!-- Sons -->
<audio id="engine" src="https://actions.google.com/sounds/v1/transportation/car_engine.ogg" loop></audio>
<audio id="crash" src="https://actions.google.com/sounds/v1/impacts/crash.ogg"></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");

const carImg = new Image();
carImg.src = "https://i.imgur.com/Qr8qW3C.png"; // voiture joueur (PNG)

let enemyColors = ["red","blue","yellow","green","orange","purple"];
let car = { x: canvas.width/2 - 25, y: 500, width: 50, height: 100 };
let enemies = [];
let speed = 5;
let score = 0;
let crashed = false;

// === Sons ===
const engineSound = document.getElementById("engine");
const crashSound = document.getElementById("crash");
engineSound.volume = 0.3;
engineSound.play().catch(()=>{}); // d√©marrage auto (peut n√©cessiter clic)

// === Contr√¥les ===
let touchStartX = null;
document.addEventListener("touchstart", e => {
  touchStartX = e.touches[0].clientX;
});
document.addEventListener("touchmove", e => {
  let dx = e.touches[0].clientX - touchStartX;
  car.x += dx * 0.2;
  touchStartX = e.touches[0].clientX;
});

window.addEventListener("deviceorientation", function(e) {
  if (e.gamma) {
    car.x += e.gamma * 0.2;
  }
});

document.addEventListener("keydown", e => {
  const step = 20;
  if (e.key === "ArrowLeft") car.x -= step;
  if (e.key === "ArrowRight") car.x += step;
});

// === G√©n√©ration ennemis ===
function spawnEnemy() {
  const laneWidth = 80;
  const lane = Math.floor(Math.random() * 3);
  enemies.push({
    x: 70 + lane * laneWidth,
    y: -120,
    width: 50,
    height: 100,
    color: enemyColors[Math.floor(Math.random()*enemyColors.length)]
  });
}
setInterval(spawnEnemy, 1500);

// === Collision ===
function isColliding(a, b) {
  return !(
    a.x + a.width < b.x ||
    a.x > b.x + b.width ||
    a.y + a.height < b.y ||
    a.y > b.y + b.height
  );
}

// === Boucle jeu ===
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Ciel
  ctx.fillStyle = "#87CEEB";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Herbe
  ctx.fillStyle = "#228B22";
  ctx.fillRect(0, 0, 60, canvas.height);
  ctx.fillRect(canvas.width - 60, 0, 60, canvas.height);

  // Route
  ctx.fillStyle = "#2f2f2f";
  ctx.fillRect(60, 0, canvas.width - 120, canvas.height);

  // Lignes
  ctx.strokeStyle = "white";
  ctx.lineWidth = 4;
  for (let y = 0; y < canvas.height; y += 40) {
    ctx.beginPath();
    ctx.moveTo(canvas.width/2, y);
    ctx.lineTo(canvas.width/2, y + 20);
    ctx.stroke();
  }

  // Voiture joueur
  ctx.drawImage(carImg, car.x, car.y, car.width, car.height);

  // Ennemis
  for (let i = 0; i < enemies.length; i++) {
    let e = enemies[i];
    e.y += speed;
    ctx.fillStyle = e.color;
    ctx.fillRect(e.x, e.y, e.width, e.height);

    // collision
    if (!crashed && isColliding(car, e)) {
      crashed = true;
      crashSound.play();
      engineSound.pause();

      // Feu
      ctx.fillStyle = "orange";
      ctx.font = "40px Arial";
      ctx.fillText("üî• BOUM !", car.x - 10, car.y);

      setTimeout(()=>{
        alert("üí• Crash ! Score final : " + score);
        document.location.reload();
      }, 1000);
    }
  }
  enemies = enemies.filter(e => e.y < canvas.height);

  // Limites
  if (car.x < 70) car.x = 70;
  if (car.x > canvas.width - car.width - 70) car.x = canvas.width - car.width - 70;

  // Score
  if (!crashed) {
    score++;
    scoreEl.textContent = "Score: " + score;
    requestAnimationFrame(draw);
  }
}

draw();
</script>
</body>
</html>
